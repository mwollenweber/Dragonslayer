Ext.namespace("SampleApp.MalwareUploader");
var MalwareUploaderPanel;

/**
 * Attach the launcher panel to the West Panel
 */
Ext.onReady(function(){
    SampleApp.Main.EventRelay.on("openMalwareUploader",SampleApp.MalwareUploader.Open);
});

/**
 * Event handler
 */
SampleApp.MalwareUploader.Open = function() {
    MalwareUploaderPanel = new SampleApp.MalwareUploader.Panel();
    MalwareUploaderPanel.show(this);
    
    SampleApp.Main.EventRelay.fireEvent("log",{
        severity: "info",
        from: "dragon_interface.js",
        message: "Malware Uploader Opened",
    });
}

/**
 * 
 */
SampleApp.MalwareUploader.Panel = function() {
	
	malware_form = new Ext.FormPanel({
		fileUpload: true,
        width: 500,
        frame: true,
        autoHeight: true,
        bodyStyle: 'padding: 10px 10px 0 10px;',
        labelWidth: 50,
        defaults: {
            anchor: '95%',
            allowBlank: false,
            msgTarget: 'side'
        },
        items: [
                {
            xtype: 'fileuploadfield',
            emptyText: 'Select malware file..',
            fieldLabel: 'Malware',
            name: 'malware_file',
            allowBlank: false,
        }
                ],
        buttons: [{
            text: 'Save',
            handler: function(){
            	var form_data = malware_form.getForm().getValues();
            	if(malware_form.getForm().isValid()){
            		malware_form.getForm().submit({
	            		url: 'controls/launchers/malware_uploader.php',
	                    waitMsg: 'Uploading malware...',
	                    success: function(fp, o){
	                    	Ext.Msg.alert('Success', 'File uploaded');
	                    	MalwareUploaderPanel.close();
	                    }
	                });
            	}
            }
        },{
            text: 'Reset',
            handler: function(){
            	malware_form.getForm().reset();
            }
        }]
	});
	
    SampleApp.MalwareUploader.Panel.superclass.constructor.call(this,{
    	layout:'fit',
    	title: 'Malware Uploader',
        width:500,
        closeAction:'hide',
        modal: true,
        items: malware_form
    });
};

/**
 *   
 */
Ext.extend(SampleApp.MalwareUploader.Panel, Ext.Window, {
});